/*!
betajs-dexie - v0.0.3 - 2020-05-30
Copyright (c) Oliver Friedmann
Apache-2.0 Software License.
*/

var Scoped=function(){var h=function(){return{get:function(e){return"undefined"!=typeof window?e?window[e]:window:"undefined"!=typeof global?e?global[e]:global:"undefined"!=typeof self?e?self[e]:self:undefined},set:function(e,t){return"undefined"!=typeof window&&(window[e]=t),"undefined"!=typeof global&&(global[e]=t),"undefined"!=typeof self&&(self[e]=t),t},getPath:function(e){if(!e)return this.get();var t=e.split(".");if(1==t.length)return this.get(e);for(var n=this.get(t[0]),a=1;a<t.length;++a){if(!n)return n;n=n[t[a]]}return n},setPath:function(e,t){var n=e.split(".");if(1==n.length)return this.set(e,t);for(var a=this.get(n[0])||this.set(n[0],{}),r=1;r<n.length-1;++r)n[r]in a||(a[n[r]]={}),a=a[n[r]];return a[n[n.length-1]]=t}}}.call(this),f=function(){return{method:function(e,t){return function(){return t.apply(e,arguments)}},extend:function(e,t){for(var n in e=e||{},t=t||{})e[n]=t[n];return e},typeOf:function(e){return"[object Array]"===Object.prototype.toString.call(e)?"array":typeof e},isEmpty:function(e){if(null==e)return!0;if("array"==this.typeOf(e))return 0===e.length;if("object"!=typeof e)return!1;for(var t in e)return!1;return!0},matchArgs:function(e,t){var n=0,a={};for(var r in t)!0===t[r]||this.typeOf(e[n])==t[r]?(a[r]=e[n],n++):"undefined"==this.typeOf(e[n])&&n++;return a},stringify:function(e){return"function"==this.typeOf(e)?""+e:JSON.stringify(e)}}}.call(this),o=function(){return{__namespace:"Scoped",__revert:null,upgrade:function(e){var t=h.get(e||o.__namespace);if(t&&"object"===f.typeOf(t)&&t.guid===this.guid&&"string"===f.typeOf(t.version)){if(!1===this.upgradable||!1===t.upgradable)return t;for(var n=this.version.split("."),a=t.version.split("."),r=!1,i=0;i<Math.min(n.length,a.length)&&(r=parseInt(n[i],10)>parseInt(a[i],10),n[i]===a[i]);++i);return r?this.attach(e):t}return this.attach(e)},attach:function(e){e&&(o.__namespace=e);var t=h.get(o.__namespace);if(t===this)return this;if(o.__revert=t)try{var n=t.__exportScoped();this.__exportBackup=this.__exportScoped(),this.__importScoped(n)}catch(a){}return h.set(o.__namespace,this),this},detach:function(e){return e&&h.set(o.__namespace,null),"undefined"!=typeof o.__revert&&h.set(o.__namespace,o.__revert),delete o.__revert,o.__exportBackup&&this.__importScoped(o.__exportBackup),this},exports:function(e,t,n){return"object"==typeof(e=e||("undefined"!=typeof module?module:null))&&e&&"exports"in e&&(n||e.exports===this||!e.exports||f.isEmpty(e.exports))&&(e.exports=t||this),this}}}.call(this);function _(e){var o={tree:"boolean"==typeof e.tree&&e.tree,global:"boolean"==typeof e.global&&e.global,root:"object"==typeof e.root?e.root:{}};function r(e){return{route:"string"==typeof e.route?e.route:null,parent:"object"==typeof e.parent?e.parent:null,ready:"boolean"==typeof e.ready&&e.ready,children:{},watchers:[],data:{},lazy:[]}}var s=r({ready:!0});if(o.tree)if(o.global){try{window&&(s.data=window)}catch(t){}try{global&&(s.data=global)}catch(t){}try{self&&(s.data=self)}catch(t){}}else s.data=o.root;function c(e){if(!e.ready)if(!e.parent||e.parent.ready){if(e.route&&e.parent&&e.route in e.parent.data){e.data=e.parent.data[e.route],e.ready=!0;for(var t=0;t<e.watchers.length;++t)e.watchers[t].callback.call(e.watchers[t].context||this,e.data);for(var n in e.watchers=[],e.children)c(e.children[n])}}else c(e.parent)}function i(e,t){if("object"==typeof t&&e.ready)for(var n in t)e.data[n]=t[n];else e.data=t;if("object"==typeof t)for(var a in t)e.children[a]&&(e.children[a].data=t[a]);for(var r in!function i(e){if(!e.ready){e.parent&&!e.parent.ready&&i(e.parent),e.ready=!0,e.parent&&o.tree&&"object"==typeof e.parent.data&&(e.parent.data[e.route]=e.data);for(var t=0;t<e.watchers.length;++t)e.watchers[t].callback.call(e.watchers[t].context||this,e.data);e.watchers=[]}}(e),e.children)c(e.children[r])}function l(e){if(!e)return s;for(var t=e.split("."),n=s,a=0;a<t.length;++a)t[a]in n.children?n=n.children[t[a]]:(n.children[t[a]]=r({parent:n,route:t[a]}),c(n=n.children[t[a]]));return n}return{extend:function(e,t){i(l(e),t)},set:function(e,t){var n=l(e);n.data&&!function a(e){if(e.ready&&e.data)for(var t in e.data)delete e.data[t]}(n),i(n,t)},get:function(e){var t=l(e);return t.ready?t.data:null},lazy:function(e,t,n){var a=l(e);a.ready?t(n||this,a.data):a.lazy.push({callback:t,context:n})},digest:function(e){c(l(e))},obtain:function(e,t,n){!function r(e,t,n){if(e.ready)t.call(n||this,e.data);else if(e.watchers.push({callback:t,context:n}),0<e.lazy.length){var a=function(e){if(0<e.lazy.length){var t=e.lazy.shift();t.callback.call(t.context||this,e.data),a(e)}};a(e)}}(l(e),t,n)},unresolvedWatchers:function(e){return function i(e,t,n){for(var a in n=n||[],!(e=e||s).ready&&0===e.lazy.length&&0<e.watchers.length&&n.push(t),e.children){var r=e.children[a];n=i(r,(t?t+".":"")+r.route,n)}return n}(l(e),e)},__export:function(){return{options:o,nsRoot:s}},__import:function(e){o=e.options,s=e.nsRoot}}}var t=_({tree:!0,global:!0}),n=_({tree:!0}),a=function m(e,t,n,a){var r=null,i=[],o=t,s=n,c=a,l=_({tree:!0}),u=_({tree:!1}),p={global:{namespace:c},root:{namespace:s},local:{namespace:l},"default":{namespace:u},parent:{namespace:o},scope:{namespace:l,readonly:!1}},d=function(i,o,s){var c=f.matchArgs(i,{options:"object",namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),e=f.extend({lazy:this.options.lazy},c.options||{}),l=this.resolve(c.namespaceLocator),t=function(){this.require(c.dependencies,c.hiddenDependencies,function(){for(var e=[],t=0;t<arguments.length;++t)e.push(arguments[t]);if(e[e.length-1].ns=l,this.options.compile){for(var n=[],a=0;a<i.length;++a)n.push(f.stringify(i[a]));this.compiled+=this.options.ident+"."+o+"("+n.join(", ")+");\n\n"}this.options.dependencies&&(this.dependencies[l.path]=this.dependencies[l.path]||{},c.dependencies&&c.dependencies.forEach(function(e){this.dependencies[l.path][this.resolve(e).path]=!0},this),c.hiddenDependencies&&c.hiddenDependencies.forEach(function(e){this.dependencies[l.path][this.resolve(e).path]=!0},this));var r=this.options.compile?{}:c.callback.apply(c.context||this,e);s.call(this,l,r)},this)};return e.lazy?l.namespace.lazy(l.path,t,this):t.apply(this),this};return{getGlobal:f.method(h,h.getPath),setGlobal:f.method(h,h.setPath),options:{lazy:!1,ident:"Scoped",compile:!1,dependencies:!1},compiled:"",dependencies:{},nextScope:function(){return r=r||m(this,l,s,c)},subScope:function(){var e=this.nextScope();return i.push(e),r=null,e},binding:function(e,t,n){var a;return p[e]&&p[e].readonly||(a="string"!=f.typeOf(t)?{namespace:_({tree:!0,root:t}),path:null}:this.resolve(t),p[e]=f.extend(n,a)),this},resolve:function(e){var t=e.split(":");if(1==t.length)throw"The locator '"+t[0]+"' requires a namespace.";var n=p[t[0]];if(!n)throw"The namespace '"+t[0]+"' has not been defined (yet).";return{namespace:n.namespace,path:n.path&&t[1]?n.path+"."+t[1]:n.path||t[1]}},define:function(){return d.call(this,arguments,"define",function(e,t){if(e.namespace.get(e.path))throw"Scoped namespace "+e.path+" has already been defined. Use extend to extend an existing namespace instead";e.namespace.set(e.path,t)})},assumeVersion:function(){var i=f.matchArgs(arguments,{assumption:!0,dependencies:"array",callback:!0,context:"object",error:"string"}),e=i.dependencies||[];e.unshift(i.assumption),this.require(e,function(){var e=arguments,t=e[0].replace(/[^\d\.]/g,"");e[0]=t.split(".");for(var n=0;n<e[0].length;++n)e[0][n]=parseInt(e[0][n],10);if("function"===f.typeOf(i.callback)){if(!i.callback.apply(i.context||this,i))throw"Scoped Assumption '"+i.assumption+"' failed, value is "+t+(i.error?", but assuming "+i.error:"")}else for(var a=(i.callback+"").replace(/[^\d\.]/g,"").split("."),r=0;r<Math.min(e[0].length,a.length);++r)if(parseInt(a[r],10)>e[0][r])throw"Scoped Version Assumption '"+i.assumption+"' failed, value is "+t+", but assuming at least "+i.callback})},extend:function(){return d.call(this,arguments,"extend",function(e,t){e.namespace.extend(e.path,t)})},require:function(){var t=f.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:"function",context:"object"});t.callback=t.callback||function(){};var e=t.dependencies||[],n=e.concat(t.hiddenDependencies||[]),a=n.length,r=[],i={};if(a)for(var o=function(e){this.i<r.length&&(r[this.i]=e),0==--a&&(r.push(i),t.callback.apply(t.context||this.ctx,r))},s=0;s<n.length;++s){var c=this.resolve(n[s]);s<e.length&&r.push(null),c.namespace.obtain(c.path,o,{ctx:this,i:s})}else r.push(i),t.callback.apply(t.context||this,r);return this},digest:function(e){var t=this.resolve(e);return t.namespace.digest(t.path),this},unresolved:function(e){var t=this.resolve(e);return t.namespace.unresolvedWatchers(t.path)},__export:function(){return{parentNamespace:o.__export(),rootNamespace:s.__export(),globalNamespace:c.__export(),localNamespace:l.__export(),privateNamespace:u.__export()}},__import:function(e){o.__import(e.parentNamespace),s.__import(e.rootNamespace),c.__import(e.globalNamespace),l.__import(e.localNamespace),u.__import(e.privateNamespace)}}}(0,n,n,t),e=f.extend(a,function(){return{guid:"4b6878ee-cb6a-46b3-94ac-27d91f58d666",version:"0.0.22",upgradable:!0,upgrade:o.upgrade,attach:o.attach,detach:o.detach,exports:o.exports,__exportScoped:function(){return{globalNamespace:t.__export(),rootNamespace:n.__export(),rootScope:a.__export()}},__importScoped:function(e){t.__import(e.globalNamespace),n.__import(e.rootNamespace),a.__import(e.rootScope)}}}.call(this));return(e=e.upgrade()).exports(),e}.call(this);(function(){var e=this.subScope();e.binding("module","global:BetaJS.Data.Databases.Dexie"),e.binding("base","global:BetaJS"),e.binding("data","global:BetaJS.Data"),e.define("module:",function(){return{guid:"5bd48095-7aea-4962-b1d3-75a575bce453",version:"0.0.3",datetime:1590864002595}}),e.assumeVersion("base:version","~1.0.96"),e.assumeVersion("data:version","~1.0.41"),e.define("module:DexieDatabaseTable",["data:Databases.DatabaseTable","base:Promise","base:Iterators.ArrayIterator","base:Tokens","base:Objs","base:Types","data:Queries"],function(e,i,o,n,s,c,l,t){var a=["weak"];return e.extend({scoped:t},function(t){return{table:function(){return this.__table||(this.__table=this._database._getTable(this._table_name)),this.__table},primary_key:function(){return"_id"},_insertRow:function(t){return t[this.primary_key()]||(t[this.primary_key()]=n.generate_token()),i.fromNativePromise(this.table().add(t)).mapSuccess(function(e){return t},this)},_removeRow:function(e){return i.fromNativePromise(this.table()["delete"](e[this.primary_key()]))},_findOne:function(e){return e[this.primary_key()]?i.fromNativePromise(this.table().get(e[this.primary_key()])):t._findOne.call(this,e)},_updateRow:function(e,t){return i.fromNativePromise(this.table().update(e[this.primary_key()],t)).mapSuccess(function(){return t})},_encode:function(t){return t=s.map(t,function(e){return e&&(c.is_object(e)||c.is_array(e))?this._encode(e):e},this),a.forEach(function(e){e in t&&(t[e+"_reserved"]=t[e],delete t[e])}),t},_decode:function(t){return t=s.map(t,function(e){return e&&(c.is_object(e)||c.is_array(e))?this._decode(e):e},this),a.forEach(function(e){e+"_reserved"in t&&(t[e]=t[e+"_reserved"],delete t[e+"_reserved"])}),t},_clear:function(){return i.fromNativePromise(this.table().clear())},_find:function(t,e){if(!(t=t||{})||c.is_empty(t))return i.fromNativePromise(this.table().toArray()).mapSuccess(function(e){return new o(e)},this);var n=s.splitObject(t,function(e){return l.isEqualValueKey(e)}),a=this.table(),r=!1;return c.is_empty(n[0])||(a=a.where(s.keys(n[0])).equals(s.values(n[0])),r=!0),t=n[1],!c.is_empty(t)&&r&&(a=a.and(function(e){return l.evaluate(t,e)})),(e=e||{}).sort&&(a=a.orderBy(s.ithKey(e.sort))),e.skip&&(a=a.offset(e.skip)),e.limit&&(a=a.limit(e.limit)),i.fromNativePromise(a.toArray()).mapSuccess(function(e){return c.is_empty(t)||r||(e=e.filter(function(e){return l.evaluate(t,e)})),new o(e)},this).error(function(e){console.warn(e)})}}})}),e.define("module:DexieDatabase",["data:Databases.Database","base:Promise","module:DexieDatabaseTable","base:Objs","base:Types"],function(e,t,a,r,i,n){return e.extend({scoped:n},function(n){return{constructor:function(e,t){n.constructor.call(this),this._db=e,this._config=t||{},this._dexie=null},destroy:function(){this._unbind(),n.destroy.call(this)},_unbind:function(){this._dexie&&(this._dexie.close(),this._dexie=null)},_bind:function(){this._dexie||(this._dexie=new Dexie(this._db),this._dexie.version(1).stores(r.map(this._config,function(e){return i.is_array(e)?e.join(","):e})),this._dexie.open())},_tableClass:function(){return a},_getTable:function(e){return this._bind(),this._dexie[e]},deleteDatabase:function(){return this._unbind(),Dexie["delete"](this._db)}}})})}).call(Scoped);